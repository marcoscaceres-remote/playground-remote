<!DOCTYPE html>
<title>Application badge API test</title>
<meta name="theme-color" content="red" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="apple-touch-icon" href="icon.png" />
<link rel="manifest" href="manifest.json" />
<body>
    <h2>Badger</h2>
    <input type="number" id="badge" value="1" />
    <output id="output">...idle...</output>
    <script>
        const badgeInput = document.getElementById("badge");
        const output = document.getElementById("output");
        badgeInput.addEventListener("change", async () => {
            try {
                switch (true) {
                  case badgeInput.value === "":
                    await navigator.clearAppBadge();
                    output.textContent = `Success. Cleared badge.`;
                    break;
                  case badgeInput.value === "0":
                    await navigator.setAppBadge(0);
                    output.textContent = `Success. Set badge to 0 (cleared).`;
                    break;
                  case parseInt(badgeInput.value) < 0:
                    await navigator.setAppBadge();
                    output.textContent = `Success. Set badge to flag.`;
                    break
                  default:
                    await navigator.setAppBadge(badgeInput.value);
                    output.textContent = `Success. Set badge to ${badgeInput.value}.`;
                }
            } catch (e) {
                output.textContent = `Error: ${e.message}`;
            }
        });
        // register service worker
        window.onload = async () => {
            try {
                const reg = await navigator.serviceWorker.register("sw.js");
                output.textContent += `Service worker registered. Scope: ${reg.scope}`;
            } catch (e) {
                output.textContent += `Service worker registration failed: ${e.message}`;
            }
        };
    </script>
</body>
